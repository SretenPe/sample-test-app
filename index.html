<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js"> </script>
        <script>
            var image = new Image()
        </script>

        <style>
            .button {
              border: none;
              color: white;
              padding: 15px 32px;
              text-align: center;
              text-decoration: none;
              display: inline-block;
              font-size: 16px;
              margin: 4px 2px;
              cursor: pointer;
            }
            
            .button1 {background-color: #4CAF50;} /* Green */
            .button2 {background-color: #008CBA;} /* Blue */
        </style>
    </head>
    <body>
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <img alt="Bootstrap Image Preview" src="https://team3pytest.herokuapp.com/edit1.jpg" />
                    <div class="jumbotron card card-block">
                        <h2>
                            Signature Fraud Detection
                        </h2>
                        <p>
                            To verify a signature, click the button below and upload a close-up image of a signature.
                        </p>
                        <input type='file' onchange="readURL(this);" />
                        <img id="blah" src="https://placehold.it/180" alt="your image" width="224" height="224"/> 
                        <button class="button button2" onclick="predict()">Predict</button>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <label>Original prediction</label>
                    <div id="zeroPrediction"></div>
                </div>
                <div class="col-md-4">
                    <label>Forge prediction</label>
                    <div id="onePrediction"></div>
                </div>
                <div class="col-md-4">
                    <label>Final prediction</label>
                    <div id="prediction"></div>
                </div>
            </div>
        </div>

    </body>
    <script>
        

        function readURL(input) 
        {
            if (input.files && input.files[0]) 
            {
                var reader = new FileReader();
                
                reader.onload = function (e) {
                    $('#blah')
                        .attr('src', e.target.result);
                    image.src = e.target.result
                };

                reader.readAsDataURL(input.files[0]);

        }
        }

        async function predict() 
        {
            let model = await tf.loadLayersModel('https://team3pytest.herokuapp.com/model.json');
            model.summary();

            const elem = document.createElement('canvas');
            elem.height = 224
            elem.width = 224
            const ctx = elem.getContext('2d')
            ctx.drawImage(image, 0, 0, 224, 224);
            var imgData = ctx.getImageData(0, 0, 224, 224)
            

            var example = tf.browser.fromPixels(imgData);
            example = example.expandDims(0);
            const output = await model.predict(example).data();

            var zero_prediction = output[0].toFixed(4)
            var one_prediction = output[1].toFixed(4)

            var finalPrediction = zero_prediction>one_prediction ? 'Signature is original' : 'Signature is forged'

            document.getElementById('zeroPrediction').innerText = zero_prediction
            document.getElementById('onePrediction').innerText = one_prediction
            document.getElementById('prediction').innerText = finalPrediction

            console.log(output);


        }

		//document.getElementById('outputField').innerText = model.predict(tf.tensor2d([20],[1,1]));
    </script>
	
</html>